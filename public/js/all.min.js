(function () {
    angular.module('football.service.articles', []);
    angular.module('football.service.commands', []);
    angular.module('football.service.members', []);
    angular.module('football.service.tags', []);

    angular.module('football.controller.articles', [
        'football.service.articles'
    ]);
    angular.module('football.controller.commands', [
        'football.service.commands'
    ]);
    angular.module('football.controller.members', [
        'football.service.members'
    ]);
    angular.module('football.controller.tags', [
        'football.service.tags'
    ]);

    angular
        .module('football.controllers', [
            'football.controller.articles',
            'football.controller.commands',
            'football.controller.members',
            'football.controller.tags'
        ])
    ;
})();
(function () {
    angular
        .module("football", [
            'ngMaterial',
            'ngMdIcons',
            'ui.router',
            'football.controllers',
            'ngFileUpload'
        ])
        //.constant("server_host", "http://football.local")
        .constant("server_host", "")
        .config(function ($stateProvider, $urlRouterProvider) {
            $urlRouterProvider.otherwise("/");

            $stateProvider
                .state("index", {
                    url: "/",
                    controller: "ArticlesCtrl",
                    templateUrl: "components/articles/articles.html"
                })
                .state("article", {
                    url: "/articles/:id",
                    controller: "ArticleCtrl",
                    templateUrl: "components/articles/article.html"
                })
                .state("commands", {
                    url: "/commands",
                    controller: "CommandsCtrl",
                    templateUrl: "components/commands/commands.html"
                })
                .state("command", {
                    url: "/commands/:id",
                    controller: "CommandCtrl",
                    templateUrl: "components/commands/command.html"
                })
                .state("members", {
                    url: "/members",
                    controller: "MembersCtrl",
                    templateUrl: "components/members/members.html"
                })
                .state("member", {
                    url: "/members/:id",
                    controller: "MemberCtrl",
                    templateUrl: "components/members/member.html"
                })
                .state("tag", {
                    url: "/tags/:id",
                    controller: "TagCtrl",
                    templateUrl: "components/tags/tag.html"
                })
            ;
        })
    ;
})();
(function () {
    angular
        .module('football.controller.articles')
        .controller('ArticleCtrl', ArticleCtrl)
    ;

    ArticleCtrl.$inject = [
        '$scope',
        '$state',
        '$stateParams',
        'ArticlesUtils'
    ];

    //Current article block
    function ArticleCtrl ($scope, $state, $stateParams, ArticlesUtils) {
        ArticlesUtils
            .get($stateParams.id)
            .then(function (response) {
                $scope.article = response.data;
            }, function (error) {
                console.log(error);
            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };
    }
})();
(function () {
    angular
        .module('football.controller.articles')
        .controller('ArticlesCtrl', ArticlesCtrl)
    ;

    ArticlesCtrl.$inject = [
        '$scope',
        '$mdDialog',
        '$state',
        'ArticlesUtils'
    ];

    //Block articles controller
    function ArticlesCtrl ($scope, $mdDialog, $state, ArticlesUtils) {
        ArticlesUtils
            .all()
            .then(function (response) {
                $scope.articles = response.data.data;
            }, function (error) {
                console.log(error);
            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };

        $scope.showModal = function (ev) {
            $mdDialog.show({
                    controller: 'CreateArticleCtrl',
                    templateUrl: 'components/articles/create-article.html',
                    targetEvent: ev
                })
                .then(function (answer) {
                    console.log(answer);

                    tags = [];

                    for (var i = 0; i < answer.tags.length; i++) {
                        tag = {
                            title: answer.tags[i]
                        };

                        tags.push(tag);
                    }

                    answer.tags = tags;

                    $scope.articles.splice(0, 0, answer)
                }, function () {

                })
            ;
        }
    }
})();
(function () {
    angular
        .module('football.directive.index', [])
    ;
})();
(function () {
    angular
        .module('football.service.articles')
        .factory('ArticlesUtils', ArticlesUtils)
    ;

    function ArticlesUtils($http, $q, server_host) {
        return {
            all: function () {
                var defer = $q.defer();

                console.log(1);

                $http
                    .get(server_host + "/api/articles")
                    .then(function (success) {
                        defer.resolve(success)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            },
            get: function (id) {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/articles/" + id)
                    .then(function (success) {
                        defer.resolve(success)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise
            },
            create: function (data) {
                var defer = $q.defer();

                $http
                    .post(server_host + "/api/articles", data)
                    .then(function (success) {
                        defer.resolve(success);
                    }, function (error) {
                        defer.reject();
                    })
                ;

                return defer.promise;
            }
        }
    }

    ArticlesUtils.$inject = [
        '$http',
        '$q',
        'server_host'
    ];
})();
(function () {
    angular
        .module('football.controller.articles')
        .controller('CreateArticleCtrl', CreateArticleCtrl)
    ;

    CreateArticleCtrl.$inject = [
        '$scope',
        '$mdDialog',
        'ArticlesUtils'
    ];

    //Current article block
    function CreateArticleCtrl ($scope, $mdDialog, ArticlesUtils) {
        $scope.article = {
            tags: [

            ]
        };

        $scope.cancel = function () {
            $mdDialog.cancel();
        };

        $scope.answer = function(answer) {
            ArticlesUtils
                .create(answer)
                .then(function () {
                    $mdDialog.hide(answer);

                    alert('Стаття успішно створена!')
                }, function (){

                })
            ;
        };
    }
})();
(function () {
    angular
        .module('football.controller.commands')
        .controller('CommandCtrl', CommandCtrl)
    ;

    CommandCtrl.$inject = [
        '$scope',
        '$state',
        '$stateParams',
        'CommandsUtils'
    ];

    //Command Ctrl block
    function CommandCtrl ($scope, $state, $stateParams, CommandsUtils) {
        CommandsUtils
            .get($stateParams.id)
            .then(function (response) {
                $scope.command = response.data;
            }, function (error) {
                
            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };
    }
})();
(function () {
    angular
        .module('football.controller.commands')
        .controller('CommandsCtrl', CommandsCtrl)
    ;

    CommandsCtrl.$inject = [
        '$scope',
        '$mdDialog',
        '$state',
        'CommandsUtils'
    ];

    //Commands Controller block
    function CommandsCtrl ($scope, $mdDialog, $state, CommandsUtils) {
        CommandsUtils
            .all()
            .then(function (response) {
                $scope.commands = response.data.data;
            }, function (error) {

            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };

        $scope.showModal = function (ev) {
            $mdDialog.show({
                controller: 'CreateCommandCtrl',
                templateUrl: 'components/commands/create-command.html',
                targetEvent: ev
            })
                .then(function (answer) {
                    console.log(answer)
                }, function () {

                })
            ;

        }
    }
})();
(function () {
    angular
        .module('football.service.commands')
        .factory('CommandsUtils', CommandsUtils)
    ;

    function CommandsUtils ($http, $q, Upload, server_host) {
        return {
            all: function () {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/commands")
                    .then(function (success) {
                        defer.resolve(success)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            },
            get: function (id) {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/commands/" + id)
                    .then(function (success) {
                        defer.resolve(success)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            },
            create: function (data) {
                var defer = $q.defer();

                Upload.upload({
                    url: server_host + "/api/commands",
                    data: data
                }).then(function (resp) {
                    defer.resolve(resp);
                }, function (resp) {
                    console.log('Error status: ' + resp.status);

                    defer.reject(resp)
                }, function (evt) {
                    var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
                });

                return defer.promise;
            }
        }
    }

    CommandsUtils.$inject = [
        '$http',
        '$q',
        'Upload',
        'server_host'
    ];
})();
(function () {
    angular
        .module('football.controller.commands')
        .controller('CreateCommandCtrl', CreateCommandCtrl)
    ;

    CreateCommandCtrl.$inject = [
        '$scope',
        '$mdDialog',
        'CommandsUtils'
    ];

    //Create Command Controller
    function CreateCommandCtrl ($scope, $mdDialog, CommandsUtils) {
        $scope.cancel = function () {
            $mdDialog.cancel();
        };

        $scope.answer = function(answer) {
            CommandsUtils
                .create(answer)
                .then(function (response) {
                    $mdDialog.hide(answer);

                    alert('Команда успішно створена!')
                }, function (error) {

                })
            ;
        };
    }
})();
(function () {
    angular
        .module('football.controller.members')
        .controller('CreateMemberCtrl', CreateMemberCtrl)
    ;

    CreateMemberCtrl.$inject = [
        '$scope',
        '$mdDialog',
        'MembersUtils',
        'CommandsUtils'
    ];

    function CreateMemberCtrl($scope, $mdDialog, MembersUtils, CommandsUtils) {
        CommandsUtils
            .all()
            .then(function (response) {
                $scope.commands = response.data.data;
            }, function (error) {

            })
        ;

        $scope.cancel = function () {
            $mdDialog.cancel();
        };

        $scope.answer = function(answer) {
            MembersUtils
                .create(answer)
                .then(function (response) {
                    $mdDialog.hide(answer);

                    alert('Футболіст успішно добавлений')
                }, function () {

                })
            ;
        };
    }
})();
(function () {
    angular
        .module('football.controller.members')
        .controller('MemberCtrl', MemberCtrl)
    ;

    MemberCtrl.$inject = [
        '$scope',
        '$state',
        '$stateParams',
        'MembersUtils'
    ];

    function MemberCtrl($scope, $state, $stateParams, MembersUtils) {
        MembersUtils
            .get($stateParams.id)
            .then(function (response) {
                $scope.member = response.data;
            }, function (error) {

            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };
    }
})();
(function () {
    angular
        .module('football.controller.members')
        .controller('MembersCtrl', MembersCtrl)
    ;

    MembersCtrl.$inject = [
        '$scope',
        '$state',
        '$mdDialog',
        'MembersUtils'
    ];

    function MembersCtrl($scope, $state, $mdDialog, MembersUtils) {
        MembersUtils
            .all()
            .then(function (response) {
                $scope.members = response.data.data
            }, function (error) {

            })
        ;

        $scope.showModal = function (ev) {
            $mdDialog.show({
                    controller: 'CreateMemberCtrl',
                    templateUrl: 'components/members/create-member.html',
                    targetEvent: ev
                })
                .then(function (answer) {
                    console.log(answer)
                }, function () {

                })
            ;

        };

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };
    }
})();
(function () {
    angular
        .module('football.service.members')
        .factory('MembersUtils', MembersUtils)
    ;

    MembersUtils.$inject = [
        '$http',
        '$q',
        'Upload',
        'server_host'
    ];

    function MembersUtils($http, $q, Upload, server_host) {
        return {
            all: function () {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/members")
                    .then(function (response) {
                        defer.resolve(response)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            },
            get: function (id) {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/members/" + id)
                    .then(function (response) {
                        defer.resolve(response)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            },
            create: function (data) {
                var defer = $q.defer();

                Upload.upload({
                    url: server_host + "/api/members",
                    data: data
                }).then(function (resp) {
                    defer.resolve(resp);
                }, function (resp) {
                    console.log('Error status: ' + resp.status);

                    defer.reject(resp)
                }, function (evt) {
                    var progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
                    //console.log('progress: ' + progressPercentage + '% ' + evt.config.data.file.name);
                });

                return defer.promise;
            }
        }
    }
})();
(function () {
    angular
        .module('football.controller.tags')
        .controller('TagCtrl', TagCtrl)
    ;

    TagCtrl.$inject = [
        '$scope',
        '$state',
        '$stateParams',
        'TagsUtils'
    ];

    function TagCtrl ($scope, $state, $stateParams, TagsUtils) {
        TagsUtils
            .get($stateParams.id)
            .then(function (response) {
                $scope.tag = response.data;
            }, function (error) {

            })
        ;

        $scope.go = function (state, id) {
            $state.go(state, {id: id});
        };
    }
})();
(function () {
    angular
        .module('football.service.tags')
        .factory('TagsUtils', TagsUtils)
    ;

    TagsUtils.$inject = [
        '$http',
        '$q',
        'server_host'
    ];

    function TagsUtils($http, $q, server_host) {
        return {
            get: function (id) {
                var defer = $q.defer();

                $http
                    .get(server_host + "/api/tags/" + id)
                    .then(function (response) {
                        defer.resolve(response)
                    }, function (error) {
                        defer.reject(error)
                    })
                ;

                return defer.promise;
            }
        }
    }
})();